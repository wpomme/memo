#!/bin/bash

SCRIPT_DIR=$(cd $(dirname $0); pwd)
KEYWORD_PATH="$SCRIPT_DIR/docs/$1.md"
THEME_PATH="$SCRIPT_DIR/docs/$1/$2.md"

usage() {
    exec >&2
    echo "
# 使い方
$ memo [keyword] [theme]
keyword は必須。keyword に複数のテーマがある場合はテーマも指定する。

# 例
$ memo git          # git の中にあるテーマの一覧を表示する
$ memo git log      # git の中にあるlog のメモを表示する
$ memo list         # 参照できるメモの一覧を表示する
"
    exit 1
}

case $# in
    0)
        usage
        exit 1
        ;;
    1)
        case $1 in
            help)
                usage
                ;;
            list)
                echo "メモ一覧"
                for keyword in $SCRIPT_DIR/docs/*; do
                    if [ -d "$keyword" ]; then
                        echo "  $(basename $keyword)/ (has subtopics)"
                        for subtopic in "$keyword"/*; do
                            [ -f "$subtopic" ] && echo "    $(basename $subtopic)"
                        done
                    elif [ -f "$keyword" ]; then
                        echo "  $(basename $keyword)"
                    fi
                done
                ;;
            *)
                if [ -f $KEYWORD_PATH ]; then
                    cat "$KEYWORD_PATH"
                else
                    echo "$1 というメモはない。"
                fi
                ;;
        esac
        ;;
    2)
        if [ -d $KEYWORD_PATH ]; then
            if [ -f "$THEME_PATH" ]; then
                cat "$THEME_PATH"
            else
                echo "$1 の中に$2 というメモはない。"
                echo "$1 の中にあるメモは"
                ls "$KEYWORD_PATH" 2>/dev/null | sed 's/^/  /'
                exit 1
            fi
        elif [ -f $KEYWORD_PATH ]; then
            echo "$1 はファイル。$2 は指定しない。"
        fi
        ;;
    *)
        usage
        exit 1
esac

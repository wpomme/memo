#!/bin/bash

SCRIPT_DIR=$(cd $(dirname $0); pwd)
KEYWORD_FILE="$SCRIPT_DIR/docs/$1.md"
THEME_DIR="$SCRIPT_DIR/docs/$1"
THEME_PATH="$SCRIPT_DIR/docs/$1/$2.md"

usage() {
    exec >&2
    echo "
# 使い方
$ memo [keyword] [theme]
keyword は必須。keyword に複数のテーマがある場合はテーマも指定する。

# 例
$ memo git          # git の中にあるテーマの一覧を表示する
$ memo git log      # git の中にあるlog のメモを表示する
$ memo list         # 参照できるメモの一覧を表示する
"
    exit 1
}

case $# in
    1)
        case $1 in
            help)
                usage
                ;;
            list)
                echo "メモ一覧"
                for keyword in $SCRIPT_DIR/docs/*; do
                    if [ -d "$keyword" ]; then
                        echo "  $(basename $keyword)/ (has subtopics)"
                        for subtopic in "$keyword"/*; do
                            [ -f "$subtopic" ] && echo "    $(basename $subtopic)"
                        done
                    elif [ -f "$keyword" ]; then
                        echo "  $(basename $keyword)"
                    fi
                done
                ;;
            *)
                if [ -f $KEYWORD_FILE ]; then
                    cat $KEYWORD_FILE
                elif [ -d $THEME_DIR ]; then
                    echo "メモ一覧: "
                    # TODO .mdを文字列から抜く
                    ls $THEME_DIR
                else
                    echo "$1 というメモはない。"
                fi
                ;;
        esac
        ;;
    2)
        if [ -d $KEYWORD_PATH ]; then
            if [ -f "$THEME_PATH" ]; then
                cat "$THEME_PATH"
            elif [ -f $KEYWORD_PATH ]; then
                echo "$1 はファイル。"
                echo "$1 はファイル。$2 は引数として取らない。"
            else
                echo "$1 の中に$2 というメモはない。"
                echo "$1 の中にあるメモは: "
                ls $THEME_DIR
                exit 1
            fi
        fi
        ;;
    *)
        usage
        exit 1
esac

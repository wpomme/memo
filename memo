#!/bin/bash

SCRIPT_DIR=$(cd $(dirname $0); pwd)
KEYWORD_PATH="$SCRIPT_DIR/docs/$1"
THEME_PATH="$SCRIPT_DIR/docs/$1/$2"

usage() {
    exec >&2
    echo "
# 使い方
$ memo [keyword] [theme]
keyword は必須。keyword に複数のテーマがある場合はテーマも指定する。

# 例
$ memo git          # git の中にあるテーマの一覧を表示する
$ memo git log      # git の中にあるlog のメモを表示する
$ memo list         # 参照できるメモの一覧を表示する
"
    exit 1
}

if [ $# -eq 0 ]; then
    usage
    exit 1
fi

if [ $# -eq 1 ]; then
    case $1 in
        help)
            usage
            ;;
        list)
            echo "メモ一覧"
            for keyword in $SCRIPT_DIR/docs/*; do
                if [ -d "$keyword" ]; then
                    echo "  $(basename $keyword)/ (has subtopics)"
                    for subtopic in "$keyword"/*; do
                        [ -f "$subtopic" ] && echo "    $(basename $subtopic)"
                    done
                elif [ -f "$keyword" ]; then
                    echo "  $(basename $keyword)"
                fi
            done
            ;;
        *)
            cat "$KEYWORD_PATH"
            ;;
    esac
fi

if [ $# -eq 2 ]; then
    if [ -d $KEYWORD_PATH ]; then
        if [ -f "$THEME_PATH" ]; then
            cat "$THEME_PATH"
        else
            echo "$1 の中に$2 というメモはない。"
            echo "$1 の中にあるメモは"
            ls "$KEYWORD_PATH" 2>/dev/null | sed 's/^/  /'
            exit 1
        fi
    elif [ -f $KEYWORD_PATH ]; then
        echo "$1 はファイル。$2 は指定しない。"
    fi
fi
